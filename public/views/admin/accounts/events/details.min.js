!function(){"use strict";app=app||{},app.Event=Backbone.Model.extend({idAttribute:"_id",url:function(){return"/admin/events/"+this.id+"/"}}),app.Delete=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{}},url:function(){return"/admin/events/"+app.mainView.model.id+"/"}}),app.Details=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{},pivot:"",title:"",attendance:"",participation:""},url:function(){return"/admin/events/"+app.mainView.model.id+"/"},parse:function(a){return a.event&&(app.mainView.model.set(a.event),delete a.event),a}}),app.Accounts=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{},groups:[],newAccount:""},url:function(){return"/admin/events/"+app.mainView.model.id+"/accounts/"},parse:function(a){return a.event&&(app.mainView.model.set(a.event),delete a.event),a}}),app.HeaderView=Backbone.View.extend({el:"#header",template:_.template($("#tmpl-header").html()),initialize:function(){this.model=app.mainView.model,this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes))}}),app.DetailsView=Backbone.View.extend({el:"#details",template:_.template($("#tmpl-details").html()),events:{"click .btn-update":"update"},initialize:function(){this.model=new app.Details,this.syncUp(),this.listenTo(app.mainView.model,"change",this.syncUp),this.listenTo(this.model,"sync",this.render),this.render()},syncUp:function(){this.model.set({_id:app.mainView.model.id,pivot:app.mainView.model.get("pivot"),title:app.mainView.model.get("title"),attendance:app.mainView.model.get("attendance"),participation:app.mainView.model.get("participation")})},render:function(){this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])},update:function(){this.model.save({pivot:this.$el.find('[name="pivot"]').val(),title:this.$el.find('[name="title"]').val(),attendance:this.$el.find('[name="attendance"]').val(),participation:this.$el.find('[name="participation"]').val()})}}),app.DeleteView=Backbone.View.extend({el:"#delete",template:_.template($("#tmpl-delete").html()),events:{"click .btn-delete":"delete"},initialize:function(){this.model=new app.Delete({_id:app.mainView.model.id}),this.listenTo(this.model,"sync",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes))},"delete":function(){confirm("Are you sure?")&&this.model.destroy({success:function(a,b){b.success?location.href="/admin/events/":app.deleteView.model.set(b)}})}}),app.AccountsView=Backbone.View.extend({el:"#accounts",template:_.template($("#tmpl-accounts").html()),events:{"click .btn-add":"add","click .btn-delete":"delete","click .btn-save":"saveAccounts"},initialize:function(){this.model=new app.Accounts,console.log(),this.syncUp(),this.listenTo(app.mainView.model,"change",this.syncUp),this.listenTo(this.model,"sync",this.render),this.render()},syncUp:function(){console.log("Sync Up called"),this.model.set({_id:app.mainView.model.id,accounts:app.mainView.model.get("accounts")})},render:function(){console.log("RENDER called"),console.log(this.model.get("accounts")),this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])},add:function(){var a=this.$el.find('[name="newAccount"]').val(),b=this.$el.find('[name="newAccount"] option:selected').text();if(!a)return void alert("Please select an account.");var c=!1;if(console.log(this.model.get("accounts")),_.each(this.model.get("accounts"),function(b){a===b&&(c=!0)}),c)return void alert("That acccount already exists.");console.log(a+" -- "+b),this.model.get("accounts").push(a),console.log(JSON.stringify(this.model.get("accounts"))),console.log($("select").find("option:selected").remove());var d=this.model.get("accounts");console.log(" this.model.get(accounts) : "+d),this.render()},"delete":function(a){if(confirm("Are you sure?")){var b=this.$el.find(".btn-delete").index(a.currentTarget);this.model.get("accounts").splice(b,1),this.render()}},saveAccounts:function(){this.model.save(),window.location.reload()}}),app.MainView=Backbone.View.extend({el:".page .container",initialize:function(){app.mainView=this,this.model=new app.Event(JSON.parse(unescape($("#data-record").html()))),app.headerView=new app.HeaderView,app.detailsView=new app.DetailsView,app.deleteView=new app.DeleteView,app.accountView=new app.AccountsView}}),$(document).ready(function(){app.mainView=new app.MainView})}();
//# sourceMappingURL=details.min.js.map